<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.mvp.mapper.AdminPurchaseMapper">
	
	<!-- 관리자 개별 구매/대여 관리 리스트 출력-->
	<select id="adminSelectPurchaseList" resultType="com.mvp.model.PurchaseViewVO">
		<![CDATA[

			SELECT * FROM(
			    SELECT /*+ INDEX_DESC(purchase SYS_C008544)*/ ROWNUM AS rn, id, userId, movieId,
			    (SELECT movieTitle FROM movie WHERE movie.movieId=purchase.movieId) movieName,
			    startDate, expiredDate,rentalPrice, buyPrice
			    FROM purchase
			    WHERE 
			]]>         
            <if test="keyword != null">
                userId LIKE '%'||#{keyword}||'%' AND
            </if>
            
	      <![CDATA[        
	             rownum <= #{pageNum} * #{amount}
	            )
	        where rn > (#{pageNum} - 1) * #{amount}
	        
	        
	      ]]>
		
	</select>
	
	<!-- 내역 게시글 개수 like로 할지 =이퀄로 할지 결정할 것 -->
	<select id="boardGetTotal" resultType="int">
		SELECT COUNT(*) FROM purchase
		<if test="keyword !=null">
			WHERE userId LIKE '%'|| #{keyword} || '%' 
		</if>
	</select>
	
  </mapper>